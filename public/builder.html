<!doctype html>
<html lang="pt-BR">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Builder - Luma</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-black overflow-hidden">
  <div id="root"></div>
  <script type="text/babel">
    const {useState,useEffect} = React;
    function Builder(){
      const [step,setStep]=useState(1);
      const [user,setUser]=useState(null);
      const [usesLeft,setUsesLeft]=useState(0);
      useEffect(()=>{ fetch('/api/user',{credentials:'include'}).then(r=>{ if(!r.ok) return window.location.href='/'; return r.json() }).then(j=>{ setUser(j); setUsesLeft((j.uses_daily||3) - (j.uses_today||0)); }); },[]);
      const startBuilder=async(e)=>{
        e.preventDefault();
        const form = new FormData(e.target);
        const payload = Object.fromEntries(form.entries());
        const res = await fetch('/api/builder/roblox',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
        const j = await res.json();
        if(res.status===403 && j.error==='limit'){ alert('Você atingiu o limite de 3 usos hoje. Volte depois de 00:00 (Horário de São Paulo).'); return; }
        if(j.output){ navigator.clipboard.writeText(j.output); alert('Output copiado!'); setUsesLeft(usesLeft-1); }
      };
      return (<div className="min-h-screen flex items-center justify-center p-6"><div className="max-w-2xl w-full space-y-6 text-white"><h1 className="text-2xl">Luma Builder</h1>{step===1 && <div className="p-6 bg-neutral-900 rounded"><p>Bem-vindo! Este passo a passo irá te guiar. Você tem <strong className="text-purple-400">{usesLeft}</strong> usos restantes hoje.</p><div className="mt-4"><button onClick={()=>setStep(2)} className="px-4 py-2 bg-purple-600 rounded">Continuar</button></div></div>} {step===2 && <form onSubmit={startBuilder} className="p-6 bg-neutral-900 rounded space-y-3"><label>Link privado Roblox (obrigatório)<input name="userLink" required className="w-full p-2 bg-neutral-800 rounded mt-1"/></label><label>Escolha o jogo (obrigatório)<select name="gameKey" required className="w-full p-2 bg-neutral-800 rounded mt-1"><option value="">-- escolha --</option><option value="pls_donate">Pls Donate</option><option value="doors">Doors</option><option value="adopt_me">Adopt Me</option></select></label><label>Plataforma (opcional)<select name="platform" className="w-full p-2 bg-neutral-800 rounded mt-1"><option value="">Nenhuma</option><option value="youtube">YouTube</option><option value="tiktok">TikTok</option><option value="spotify">Spotify</option></select></label><label>Link privado da plataforma (se aplicável)<input name="platformLink" className="w-full p-2 bg-neutral-800 rounded mt-1"/></label><label>Nome de usuário na plataforma (se aplicável)<input name="platformUsername" className="w-full p-2 bg-neutral-800 rounded mt-1"/></label><div className="flex justify-between"><button type="button" onClick={()=>setStep(1)} className="px-4 py-2 bg-gray-700 rounded">Voltar</button><button type="submit" className="px-4 py-2 bg-green-600 rounded">Iniciar Builder</button></div></form>}</div></div>);
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<Builder/>);
  </script>
</body>
</html>
