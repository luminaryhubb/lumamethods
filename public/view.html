<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Luma Paste ‚Äî Visualizar</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: ui-monospace, "JetBrains Mono", monospace; background:#07070a; color:#fff; }
    .glass { background: rgba(17,24,39,0.65); backdrop-filter: blur(6px); border: 1px solid rgba(255,255,255,0.05); }
    .hidden { display:none; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

  <div class="w-full max-w-lg space-y-6">
    <div class="flex items-center justify-between">
      <h1 class="text-3xl font-bold text-purple-300">üîí Luma Paste</h1>
      <span id="views" class="text-sm text-neutral-400"></span>
    </div>

    <!-- Caixa de senha -->
    <div id="password-box" class="glass p-6 rounded-2xl shadow-xl space-y-4">
      <p class="text-neutral-300 text-sm">Este paste est√° protegido por senha.</p>
      <input id="password-input" type="password" placeholder="Digite a senha..." 
             class="w-full p-3 rounded bg-neutral-900 border border-neutral-800 text-sm focus:outline-none focus:ring-2 focus:ring-purple-600" />
      <button id="unlock-btn" 
              class="w-full px-4 py-3 rounded bg-purple-600 hover:bg-purple-500 font-medium">
        Acessar
      </button>
      <div id="error-box" class="text-sm text-red-400 hidden"></div>
    </div>

    <!-- Conte√∫do do paste -->
    <div id="content-box" class="glass p-6 rounded-2xl shadow-xl hidden">
      <h2 class="text-xl font-semibold text-purple-400 mb-3">Conte√∫do</h2>
      <pre id="paste-content" class="whitespace-pre-wrap text-sm bg-neutral-900 p-3 rounded border border-neutral-800"></pre>
      <div id="redirect-box" class="mt-4 hidden">
        <a id="redirect-link" target="_blank"
           class="inline-block w-full text-center px-4 py-3 rounded bg-green-600 hover:bg-green-500">
          Ir para redirecionamento
        </a>
      </div>
    </div>
  </div>

<script>
(async function(){
  const unlockBtn = document.getElementById('unlock-btn');
  const passwordInput = document.getElementById('password-input');
  const errorBox = document.getElementById('error-box');
  const contentBox = document.getElementById('content-box');
  const contentEl = document.getElementById('paste-content');
  const redirectBox = document.getElementById('redirect-box');
  const redirectLink = document.getElementById('redirect-link');
  const viewsEl = document.getElementById('views');

  const pasteId = window.location.pathname.split('/').pop();

  unlockBtn.addEventListener('click', async ()=>{
    errorBox.classList.add('hidden');
    unlockBtn.disabled = true;
    unlockBtn.textContent = 'Verificando...';

    try {
      const res = await fetch(`/api/view/${pasteId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ password: passwordInput.value.trim() })
      });

      const data = await res.json().catch(()=>({ error:'Resposta inv√°lida' }));

      if(!res.ok){
        errorBox.textContent = data.error || 'Senha incorreta ou erro no servidor.';
        errorBox.classList.remove('hidden');
        unlockBtn.disabled = false;
        unlockBtn.textContent = 'Acessar';
        return;
      }

      // Mostrar conte√∫do
      document.getElementById('password-box').classList.add('hidden');
      contentBox.classList.remove('hidden');
      contentEl.textContent = data.text || '(sem conte√∫do)';
      viewsEl.textContent = `üëÅÔ∏è ${data.views || 0} visualiza√ß√µes`;

      if(data.redirect){
        redirectBox.classList.remove('hidden');
        redirectLink.href = data.redirect;
      }

    } catch(e){
      errorBox.textContent = 'Erro de conex√£o.';
      errorBox.classList.remove('hidden');
    } finally {
      unlockBtn.disabled = false;
      unlockBtn.textContent = 'Acessar';
    }
  });
})();
</script>
</body>
</html>
